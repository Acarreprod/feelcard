{%- render 'section-spacing-collapsing' -%}

<style>
  #shopify-section-{{ section.id }} {
    --product-grid: auto / minmax(0, 1fr);
    --product-gallery-media-list-grid: auto / auto-flow {% if section.settings.mobile_carousel_control == 'free_scroll' %}{% if section.settings.mobile_media_size == 'expanded' %}84vw{% else %}73vw{% endif %}{% else %}100%{% endif %};
    --product-gallery-media-list-gap: {% if section.settings.mobile_media_size == 'expanded' %}var(--spacing-0-5){% else %}var(--grid-gutter){% endif %};
    
    /* Variables de couleurs modernes */
    --color-primary: #000000;
    --color-secondary: #4A5568;
    --color-accent: #FFFFFF;
    --color-success: #10B981;
    --color-text-light: #718096;
    --color-border: #E2E8F0;
    --color-surface: #F7FAFC;
    --color-hover: #EDF2F7;
  }

  @media screen and (max-width: 999px) {
    #shopify-section-{{ section.id }} {
      --section-spacing-block-start: {% if section.settings.mobile_media_size == 'expanded' %}0px{% else %}var(--container-gutter){% endif %};
    }
  }

  @media screen and (min-width: 1000px) {
    #shopify-section-{{ section.id }} {
      {%- assign media_ratio = section.settings.desktop_media_width | divided_by: 50.0 -%}
      --product-grid: auto / minmax(0, {{ media_ratio }}fr) minmax(0, {{ 2.0 | minus: media_ratio }}fr);
      --product-gallery-media-list-grid: {% if section.settings.desktop_media_layout contains 'grid' %}auto-flow dense / repeat({% if section.settings.desktop_media_layout == 'grid_one' %}1{% else %}2{% endif %}, minmax(0, 1fr)){% else %}auto / auto-flow 100%{% endif %};
      --product-gallery-media-list-gap: calc(var(--grid-gutter) / 2);
    }

    {%- if section.settings.desktop_media_layout == 'grid_highlight' -%}
    #shopify-section-{{ section.id }} .product-gallery__media-list > :not([hidden]) {
      grid-column: span 2;
    }
    #shopify-section-{{ section.id }} .product-gallery__media-list > :not([hidden]) ~ *:not(.product-gallery__media--expand) {
      grid-column: span 1;
    }
    {%- endif -%}
  }

  @media screen and (min-width: 1400px) {
    #shopify-section-{{ section.id }} {
      --product-gallery-media-list-gap: var(--grid-gutter);
    }
  }

  /* Animations globales */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes slideInLeft {
    from {
      opacity: 0;
      transform: translateX(-30px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes pulse {
    0%, 100% { 
      transform: scale(1); 
      box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4);
    }
    50% { 
      transform: scale(1.05); 
      box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
    }
  }

  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  @keyframes glow {
    0%, 100% { 
      box-shadow: 0 0 5px rgba(16, 185, 129, 0.3),
                  0 0 10px rgba(16, 185, 129, 0.2),
                  0 0 15px rgba(16, 185, 129, 0.1);
    }
    50% { 
      box-shadow: 0 0 10px rgba(16, 185, 129, 0.5),
                  0 0 20px rgba(16, 185, 129, 0.3),
                  0 0 30px rgba(16, 185, 129, 0.2);
    }
  }

  /* Section des offres avec dégradés modernes */
  .product-offers-section {
    background: linear-gradient(135deg, 
      var(--color-accent) 0%, 
      var(--color-surface) 50%, 
      var(--color-accent) 100%);
    padding: 40px 32px;
    margin: 40px 0;
    border-radius: 24px;
    box-shadow: 
      0 20px 40px rgba(0, 0, 0, 0.08),
      0 8px 16px rgba(0, 0, 0, 0.04),
      inset 0 1px 0 rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    animation: fadeInUp 0.8s ease-out;
    position: relative;
    overflow: hidden;
  }

  .product-offers-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
      transparent, 
      rgba(255, 255, 255, 0.2), 
      transparent);
    animation: shimmer 3s infinite;
  }

  .offers-title-container {
    text-align: center;
    margin-bottom: 40px;
    position: relative;
    z-index: 2;
  }

  .offers-title {
    font-size: 20px;
    font-weight: 800;
    color: var(--color-primary);
    text-transform: uppercase;
    letter-spacing: 2px;
    background: linear-gradient(135deg, 
      var(--color-primary) 0%,
      var(--color-secondary) 50%,
      var(--color-primary) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    padding: 0 24px;
    display: inline-block;
    position: relative;
    z-index: 3;
    animation: slideInLeft 0.6s ease-out 0.2s both;
  }

  .offers-title-container::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, 
      transparent 0%,
      var(--color-success) 20%,
      var(--color-primary) 50%,
      var(--color-success) 80%,
      transparent 100%);
    border-radius: 2px;
    z-index: 1;
    animation: glow 2s ease-in-out infinite;
  }

  /* Options d'offres avec design premium */
  .offer-option {
    position: relative;
    border: 2px solid var(--color-border);
    border-radius: 20px;
    padding: 32px;
    margin-bottom: 20px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    background: linear-gradient(145deg, 
      var(--color-accent) 0%,
      rgba(247, 250, 252, 0.8) 100%);
    backdrop-filter: blur(10px);
    overflow: hidden;
    animation: fadeInUp 0.6s ease-out both;
  }

  .offer-option:nth-child(1) { animation-delay: 0.1s; }
  .offer-option:nth-child(2) { animation-delay: 0.2s; }
  .offer-option:nth-child(3) { animation-delay: 0.3s; }
  .offer-option:nth-child(4) { animation-delay: 0.4s; }

  .offer-option::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, 
      rgba(16, 185, 129, 0.05) 0%,
      rgba(74, 85, 104, 0.05) 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
    border-radius: 18px;
  }

  .offer-option:hover {
    border-color: var(--color-success);
    transform: translateY(-8px) scale(1.02);
    box-shadow: 
      0 25px 50px rgba(16, 185, 129, 0.15),
      0 10px 20px rgba(0, 0, 0, 0.08),
      inset 0 1px 0 rgba(255, 255, 255, 0.6);
  }

  .offer-option:hover::before {
    opacity: 1;
  }

  .offer-option.selected {
    border-color: var(--color-success);
    background: linear-gradient(145deg, 
      rgba(16, 185, 129, 0.1) 0%,
      rgba(16, 185, 129, 0.05) 50%,
      var(--color-accent) 100%);
    transform: translateY(-12px) scale(1.03);
    box-shadow: 
      0 30px 60px rgba(16, 185, 129, 0.2),
      0 15px 30px rgba(0, 0, 0, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.8),
      0 0 0 1px rgba(16, 185, 129, 0.3);
    animation: pulse 2s infinite;
  }

  .offer-option.selected::before {
    opacity: 1;
  }

  /* Badges avec dégradés et animations */
  .offer-badge {
    position: absolute;
    top: -12px;
    right: 24px;
    padding: 10px 20px;
    border-radius: 25px;
    font-size: 12px;
    font-weight: 700;
    color: var(--color-accent);
    z-index: 5;
    box-shadow: 
      0 8px 16px rgba(0, 0, 0, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.3);
    text-transform: uppercase;
    letter-spacing: 1px;
    animation: pulse 2s infinite;
  }

  .offer-badge.popular {
    background: linear-gradient(135deg, 
      var(--color-success) 0%,
      #0EA5E9 100%);
  }

  .offer-badge.best {
    background: linear-gradient(135deg, 
      #F59E0B 0%,
      #EF4444 100%);
  }

  .offer-content {
    display: flex;
    align-items: flex-start;
    gap: 24px;
    position: relative;
    z-index: 2;
  }

  /* Radio button moderne avec animation */
  .offer-radio {
    width: 28px;
    height: 28px;
    border: 3px solid var(--color-border);
    border-radius: 50%;
    position: relative;
    flex-shrink: 0;
    margin-top: 3px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    background: var(--color-accent);
    box-shadow: 
      0 4px 8px rgba(0, 0, 0, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.5);
  }

  .offer-option:hover .offer-radio {
    border-color: var(--color-success);
    transform: scale(1.1);
  }

  .offer-option.selected .offer-radio {
    border-color: var(--color-success);
    background: linear-gradient(135deg, 
      var(--color-success) 0%,
      #0EA5E9 100%);
    transform: scale(1.15);
    box-shadow: 
      0 6px 12px rgba(16, 185, 129, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.4);
  }

  .offer-option.selected .offer-radio::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    width: 10px;
    height: 10px;
    background: var(--color-accent);
    border-radius: 50%;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    animation: scaleIn 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55) 0.1s both;
  }

  @keyframes scaleIn {
    from { transform: translate(-50%, -50%) scale(0); }
    to { transform: translate(-50%, -50%) scale(1); }
  }

  .offer-details {
    flex: 1;
  }

  .offer-title {
    font-size: 28px;
    font-weight: 800;
    background: linear-gradient(135deg, 
      var(--color-primary) 0%,
      var(--color-secondary) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 12px;
    line-height: 1.2;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .offer-bonus {
    font-size: 16px;
    color: var(--color-text-light);
    margin-bottom: 8px;
    line-height: 1.4;
    font-weight: 500;
  }

  .offer-savings {
    font-size: 16px;
    font-weight: 700;
    background: linear-gradient(135deg, 
      var(--color-success) 0%,
      #0EA5E9 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .offer-pricing {
    text-align: right;
    flex-shrink: 0;
  }

  .offer-price {
    font-size: 32px;
    font-weight: 900;
    background: linear-gradient(135deg, 
      var(--color-primary) 0%,
      var(--color-secondary) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1;
    margin-bottom: 6px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .offer-original-price {
    font-size: 16px;
    color: var(--color-text-light);
    text-decoration: line-through;
    font-weight: 500;
    opacity: 0.8;
  }

  /* Section bouton d'ajout avec dégradé premium */
  .add-to-cart-section {
    margin: 40px 0;
    animation: fadeInUp 0.8s ease-out 0.6s both;
  }

  .add-to-cart-btn {
    width: 100%;
    background: linear-gradient(135deg, 
      var(--color-primary) 0%,
      var(--color-secondary) 50%,
      var(--color-primary) 100%);
    color: var(--color-accent);
    border: none;
    padding: 20px 32px;
    border-radius: 16px;
    font-size: 18px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 2px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    box-shadow: 
      0 8px 16px rgba(0, 0, 0, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
  }

  .add-to-cart-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
      transparent, 
      rgba(255, 255, 255, 0.3), 
      transparent);
    transition: left 0.6s;
  }

  .add-to-cart-btn:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow: 
      0 16px 32px rgba(0, 0, 0, 0.25),
      0 8px 16px rgba(16, 185, 129, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.3);
    background: linear-gradient(135deg, 
      var(--color-success) 0%,
      var(--color-primary) 50%,
      var(--color-success) 100%);
  }

  .add-to-cart-btn:hover::before {
    left: 100%;
  }

  .add-to-cart-btn:active {
    transform: translateY(-2px) scale(0.98);
  }

  .add-to-cart-btn:disabled {
    background: linear-gradient(135deg, 
      var(--color-text-light) 0%,
      var(--color-border) 100%);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  .total-price {
    text-align: center;
    margin-top: 20px;
    font-size: 16px;
    color: var(--color-text-light);
    font-weight: 500;
  }

  .total-price strong {
    background: linear-gradient(135deg, 
      var(--color-primary) 0%,
      var(--color-success) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 900;
    font-size: 20px;
  }

  /* Alerte stock avec animation et dégradé */
  .stock-notice {
    background: linear-gradient(135deg, 
      #F59E0B 0%,
      #EF4444 50%,
      #F59E0B 100%);
    color: var(--color-accent);
    padding: 16px 24px;
    border-radius: 12px;
    text-align: center;
    font-weight: 700;
    margin-top: 20px;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 1px;
    box-shadow: 
      0 8px 16px rgba(245, 158, 11, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.3);
    animation: glow 2s ease-in-out infinite;
    position: relative;
    overflow: hidden;
  }

  .stock-notice::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
      transparent, 
      rgba(255, 255, 255, 0.2), 
      transparent);
    animation: shimmer 2s infinite;
  }

  /* Trust badges avec animations */
  .trust-badges {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-top: 40px;
    padding-top: 32px;
    border-top: 2px solid;
    border-image: linear-gradient(90deg, 
      transparent 0%,
      var(--color-border) 20%,
      var(--color-success) 50%,
      var(--color-border) 80%,
      transparent 100%) 1;
    animation: fadeInUp 0.8s ease-out 0.8s both;
  }

  .trust-badge {
    text-align: center;
    padding: 20px 16px;
    border-radius: 16px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    background: linear-gradient(145deg, 
      var(--color-accent) 0%,
      var(--color-surface) 100%);
    border: 1px solid var(--color-border);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
  }

  .trust-badge:hover {
    transform: translateY(-8px) scale(1.05);
    background: linear-gradient(145deg, 
      var(--color-accent) 0%,
      rgba(16, 185, 129, 0.05) 100%);
    border-color: var(--color-success);
    box-shadow: 
      0 12px 24px rgba(16, 185, 129, 0.15),
      0 6px 12px rgba(0, 0, 0, 0.08);
  }

  .trust-badge-icon {
    width: 28px;
    height: 28px;
    margin: 0 auto 12px;
    color: var(--color-success);
    transition: all 0.3s ease;
  }

  .trust-badge:hover .trust-badge-icon {
    transform: scale(1.2) rotate(5deg);
    filter: drop-shadow(0 4px 8px rgba(16, 185, 129, 0.3));
  }

  .trust-badge-text {
    font-size: 13px;
    color: var(--color-secondary);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* Autres éléments avec nouvelles couleurs */
  .product-rating {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 20px 0;
    animation: slideInLeft 0.6s ease-out 0.3s both;
  }

  .stars {
    display: flex;
    gap: 3px;
  }

  .star {
    width: 18px;
    height: 18px;
    fill: var(--color-success);
    filter: drop-shadow(0 2px 4px rgba(16, 185, 129, 0.3));
    transition: transform 0.2s ease;
  }

  .star:hover {
    transform: scale(1.2);
  }

  .rating-text {
    font-size: 14px;
    color: var(--color-text-light);
    font-weight: 500;
  }

  .professional-badge {
    display: inline-block;
    background: linear-gradient(135deg, 
      var(--color-surface) 0%,
      var(--color-hover) 100%);
    color: var(--color-secondary);
    padding: 8px 16px;
    border-radius: 25px;
    font-size: 12px;
    font-weight: 700;
    margin-bottom: 20px;
    text-transform: uppercase;
    letter-spacing: 1px;
    border: 1px solid var(--color-border);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    animation: slideInLeft 0.6s ease-out both;
  }

  .product-info__title {
    font-size: 36px;
    font-weight: 900;
    background: linear-gradient(135deg, 
      var(--color-primary) 0%,
      var(--color-secondary) 50%,
      var(--color-primary) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 20px;
    line-height: 1.2;
    animation: slideInLeft 0.6s ease-out 0.1s both;
  }

  .product-info__description {
    font-size: 16px;
    color: var(--color-text-light);
    line-height: 1.7;
    margin-bottom: 32px;
    animation: slideInLeft 0.6s ease-out 0.2s both;
  }

  /* Responsive amélioré */
  @media (max-width: 768px) {
    .offer-content {
      flex-direction: column;
      align-items: flex-start;
      gap: 20px;
    }

    .offer-pricing {
      text-align: left;
      width: 100%;
    }

    .trust-badges {
      grid-template-columns: 1fr;
      gap: 16px;
    }

    .offers-title {
      font-size: 18px;
      letter-spacing: 1px;
    }

    .offer-title {
      font-size: 24px;
    }

    .offer-price {
      font-size: 28px;
    }

    .product-info__title {
      font-size: 28px;
    }

    .product-offers-section {
      padding: 32px 24px;
      margin: 32px 0;
      border-radius: 20px;
    }

    .offer-option {
      padding: 24px;
      border-radius: 16px;
    }

    .add-to-cart-btn {
      padding: 18px 24px;
      font-size: 16px;
      border-radius: 12px;
    }
  }

  /* Animations de chargement */
  .loading-shimmer {
    background: linear-gradient(90deg,
      transparent 0%,
      rgba(255, 255, 255, 0.4) 50%,
      transparent 100%);
    animation: shimmer 1.5s infinite;
  }

  /* Micro-interactions pour les hover states */
  .offer-option:hover .offer-title {
    transform: translateX(5px);
  }

  .offer-option:hover .offer-price {
    transform: scale(1.05);
  }

  .trust-badge:hover .trust-badge-text {
    color: var(--color-success);
  }
</style>

{%- capture product_form_id -%}product-form-{{ product.id }}-{{ section.id }}{%- endcapture -%}

<div {% render 'section-properties', tight: section.settings.full_width %}>
  <product-rerender id="product-info-{{ product.id }}-{{ section.id }}" observe-form="{{ product_form_id }}" allow-partial-rerender>
    <div class="product">
      {%- if product.media.size > 0 -%}
        {%- render 'product-gallery', product: product, product_form_id: product_form_id -%}
      {%- endif -%}

      <div class="product-info">
        <span class="professional-badge">Professionnel</span>

        <h1 class="product-info__title">{{ product.title }}</h1>

        <div class="product-rating">
          <div class="stars">
            {%- for i in (1..5) -%}
              <svg class="star" viewBox="0 0 24 24">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
            {%- endfor -%}
          </div>
          <span class="rating-text">(247 avis)</span>
        </div>

        {%- if product.description != blank -%}
          <div class="product-info__description">
            <div class="prose">{{ product.description }}</div>
          </div>
        {%- endif -%}

        <div class="product-offers-section">
          <div class="offers-title-container">
            <h2 class="offers-title">Choisissez votre offre :</h2>
          </div>

          <form id="{{ product_form_id }}" action="/cart/add" method="post" enctype="multipart/form-data">
            <!-- Hidden variant selector that Shopify needs -->
            <select name="id" id="variant-selector-{{ section.id }}" style="display: none;">
              {%- for variant in product.variants -%}
                {%- if variant.available -%}
                  <option value="{{ variant.id }}"
                    data-price="{{ variant.price }}"
                    data-compare-price="{{ variant.compare_at_price }}"
                    {% if variant == product.selected_or_first_available_variant %}selected="selected"{% endif %}>
                    {{ variant.title }} - {{ variant.price | money }}
                  </option>
                {%- endif -%}
              {%- endfor -%}
            </select>
            
            <div class="offer-options">
              {%- assign sorted_variants = product.variants | sort: 'price' -%}
              {%- for variant in sorted_variants -%}
                {%- if variant.available -%}
                  {%- assign variant_title_lower = variant.title | downcase -%}
                  {%- assign quantity = 1 -%}
                  {%- if variant_title_lower contains '2' -%}
                    {%- assign quantity = 2 -%}
                  {%- elsif variant_title_lower contains '5' -%}
                    {%- assign quantity = 5 -%}
                  {%- elsif variant_title_lower contains '10' -%}
                    {%- assign quantity = 10 -%}
                  {%- endif -%}

                  {%- assign base_price = sorted_variants.first.price -%}
                  {%- assign expected_price = base_price | times: quantity -%}
                  {%- assign savings_amount = expected_price | minus: variant.price -%}
                  {%- assign savings_percent = 0 -%}
                  {%- if expected_price > 0 and savings_amount > 0 -%}
                    {%- assign savings_percent = savings_amount | times: 100 | divided_by: expected_price -%}
                  {%- endif -%}

                  {%- assign badge_text = '' -%}
                  {%- assign badge_style = 'popular' -%}
                  {%- assign bonus_text = '' -%}
                  {%- assign is_default = false -%}

                  {%- if quantity == 2 -%}
                    {%- assign badge_text = 'Le plus choisi' -%}
                    {%- assign badge_style = 'popular' -%}
                    {%- assign bonus_text = '+ Ebook Gratuit' -%}
                  {%- elsif quantity == 5 -%}
                    {%- assign bonus_text = '+ Ebook Gratuit & Cadeau 🎁' -%}
                    {%- assign is_default = true -%}
                  {%- elsif quantity == 10 -%}
                    {%- assign badge_text = 'Meilleure offre' -%}
                    {%- assign badge_style = 'best' -%}
                    {%- assign bonus_text = '+ Ebook Gratuit & Cadeau 🎁' -%}
                  {%- endif -%}

                  {%- if forloop.first and is_default == false -%}
                    {%- assign is_default = true -%}
                  {%- endif -%}

                  <div class="offer-option{% if is_default %} selected{% endif %}" 
                       data-variant-id="{{ variant.id }}"
                       data-price="{{ variant.price }}" 
                       data-compare-price="{{ variant.compare_at_price }}"
                       data-savings="{{ savings_percent }}"
                       onclick="selectVariant({{ variant.id }}, '{{ section.id }}')">
                    {%- if badge_text != blank -%}
                      <div class="offer-badge {{ badge_style }}">{{ badge_text }}</div>
                    {%- endif -%}
                    <div class="offer-content">
                      <div class="offer-radio"></div>
                      <div class="offer-details">
                        <div class="offer-title">{{ variant.title }}</div>
                        {%- if bonus_text != blank -%}
                          <div class="offer-bonus">{{ bonus_text }}</div>
                        {%- endif -%}
                        {%- if savings_percent > 0 -%}
                          <div class="offer-savings">Économisez {{ savings_percent }}%</div>
                        {%- endif -%}
                      </div>
                      <div class="offer-pricing">
                        <div class="offer-price">{{ variant.price | money_without_currency | replace: ',', '.' }} € HT</div>
                        {%- if savings_percent > 0 -%}
                          <div class="offer-original-price">{{ expected_price | money_without_currency | replace: ',', '.' }} € HT</div>
                        {%- endif -%}
                      </div>
                    </div>
                  </div>
                {%- endif -%}
              {%- endfor -%}
            </div>

            <div class="add-to-cart-section">
              <button type="submit" class="add-to-cart-btn" id="add-to-cart-btn-{{ section.id }}">
                AJOUTER AU PANIER
              </button>
              <div class="total-price">
                Prix total: <strong id="total-price-{{ section.id }}">{{ product.selected_or_first_available_variant.price | money_without_currency | replace: ',', '.' }} € HT</strong>
              </div>
              <div class="stock-notice">
                🔥 Stock Limité – VENTE D'ÉTÉ 🔥
              </div>
            </div>
          </form>
        </div>

        <div class="trust-badges">
          <div class="trust-badge">
            <svg class="trust-badge-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="m7 11 2-2-2-2"/>
              <path d="M11 13h4"/>
              <rect width="18" height="18" x="3" y="3" rx="2" ry="2"/>
            </svg>
            <div class="trust-badge-text">Livraison rapide</div>
          </div>
          <div class="trust-badge">
            <svg class="trust-badge-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
            </svg>
            <div class="trust-badge-text">Garantie qualité</div>
          </div>
          <div class="trust-badge">
            <svg class="trust-badge-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 7v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2z"/>
              <path d="M8 7V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
            </svg>
            <div class="trust-badge-text">Retour gratuit</div>
          </div>
        </div>
      </div>
    </div>
  </product-rerender>
</div>

<script>
// Variables CSS personnalisées pour les couleurs
const colors = {
  primary: '#000000',
  secondary: '#4A5568', 
  accent: '#FFFFFF',
  success: '#10B981',
  textLight: '#718096',
  border: '#E2E8F0',
  surface: '#F7FAFC',
  hover: '#EDF2F7'
};

// Fonction globale pour sélectionner une variante avec animations
function selectVariant(variantId, sectionId) {
  console.log('🎯 Selecting variant:', variantId, 'for section:', sectionId);
  
  // Mettre à jour le sélecteur caché
  const variantSelector = document.getElementById('variant-selector-' + sectionId);
  if (variantSelector) {
    variantSelector.value = variantId;
    variantSelector.dispatchEvent(new Event('change', { bubbles: true }));
  }
  
  // Animation de sélection avec feedback visuel
  const allOptions = document.querySelectorAll('#shopify-section-' + sectionId + ' .offer-option');
  const selectedOption = document.querySelector('#shopify-section-' + sectionId + ' .offer-option[data-variant-id="' + variantId + '"]');
  
  // Transition fluide pour toutes les options
  allOptions.forEach((option, index) => {
    option.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
    option.classList.remove('selected');
    
    // Animation en cascade
    setTimeout(() => {
      option.style.transform = 'scale(0.98)';
      setTimeout(() => {
        option.style.transform = '';
      }, 200);
    }, index * 50);
  });
  
  // Sélection avec animation spéciale
  if (selectedOption) {
    setTimeout(() => {
      selectedOption.classList.add('selected');
      
      // Animation de "pop" pour la sélection
      selectedOption.style.transform = 'scale(1.05)';
      setTimeout(() => {
        selectedOption.style.transform = '';
      }, 300);
      
      // Mettre à jour le prix avec animation
      const price = selectedOption.dataset.price;
      const totalPriceElement = document.getElementById('total-price-' + sectionId);
      if (totalPriceElement && price) {
        totalPriceElement.style.transition = 'all 0.3s ease';
        totalPriceElement.style.transform = 'scale(0.9)';
        totalPriceElement.style.opacity = '0.5';
        
        setTimeout(() => {
          const formattedPrice = (parseFloat(price) / 100).toFixed(2).replace('.', ',');
          totalPriceElement.textContent = formattedPrice + ' € HT';
          totalPriceElement.style.transform = 'scale(1.1)';
          totalPriceElement.style.opacity = '1';
          
          setTimeout(() => {
            totalPriceElement.style.transform = 'scale(1)';
          }, 200);
        }, 150);
      }
    }, 100);
  }
  
  // Mettre à jour l'URL avec animation de l'historique
  if (window.history && window.history.replaceState) {
    const url = new URL(window.location);
    url.searchParams.set('variant', variantId);
    window.history.replaceState({}, '', url);
  }
  
  // Effet de particules (optionnel)
  createSelectionParticles(selectedOption);
}

// Fonction pour créer un effet de particules lors de la sélection
function createSelectionParticles(element) {
  if (!element) return;
  
  const rect = element.getBoundingClientRect();
  const particleCount = 6;
  
  for (let i = 0; i < particleCount; i++) {
    const particle = document.createElement('div');
    particle.style.cssText = `
      position: fixed;
      width: 6px;
      height: 6px;
      background: linear-gradient(45deg, #10B981, #0EA5E9);
      border-radius: 50%;
      pointer-events: none;
      z-index: 1000;
      left: ${rect.left + rect.width / 2}px;
      top: ${rect.top + rect.height / 2}px;
    `;
    
    document.body.appendChild(particle);
    
    // Animation des particules
    const angle = (360 / particleCount) * i;
    const velocity = 100;
    const radian = (angle * Math.PI) / 180;
    const deltaX = Math.cos(radian) * velocity;
    const deltaY = Math.sin(radian) * velocity;
    
    particle.animate([
      { transform: 'translate(0, 0) scale(1)', opacity: 1 },
      { transform: `translate(${deltaX}px, ${deltaY}px) scale(0)`, opacity: 0 }
    ], {
      duration: 800,
      easing: 'cubic-bezier(0.4, 0, 0.2, 1)'
    }).onfinish = () => {
      document.body.removeChild(particle);
    };
  }
}

// Initialisation avec animations de chargement
document.addEventListener('DOMContentLoaded', function() {
  console.log('🚀 DOM loaded, initializing modern product page');
  
  const sectionId = '{{ section.id }}';
  const addToCartBtn = document.getElementById('add-to-cart-btn-' + sectionId);
  
  // Animation d'entrée pour les éléments
  const animateElements = document.querySelectorAll('.offer-option, .trust-badge');
  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry, index) => {
      if (entry.isIntersecting) {
        setTimeout(() => {
          entry.target.style.opacity = '1';
          entry.target.style.transform = 'translateY(0)';
        }, index * 100);
      }
    });
  }, { threshold: 0.1 });
  
  animateElements.forEach(el => {
    el.style.opacity = '0';
    el.style.transform = 'translateY(30px)';
    el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
    observer.observe(el);
  });
  
  // Gérer la soumission du formulaire avec animations
  if (addToCartBtn) {
    addToCartBtn.addEventListener('click', function(e) {
      e.preventDefault();
      
      const form = document.getElementById('{{ product_form_id }}');
      const variantSelector = document.getElementById('variant-selector-' + sectionId);
      
      if (!variantSelector || !variantSelector.value) {
        // Animation d'erreur
        this.style.background = 'linear-gradient(135deg, #EF4444, #DC2626)';
        this.textContent = 'Sélectionnez une variante';
        setTimeout(() => {
          this.style.background = '';
          this.textContent = 'AJOUTER AU PANIER';
        }, 2000);
        return;
      }
      
      // Animation de chargement premium
      this.disabled = true;
      this.style.background = 'linear-gradient(135deg, #6B7280, #4B5563)';
      this.innerHTML = `
        <span style="display: inline-flex; align-items: center; gap: 8px;">
          <svg width="16" height="16" style="animation: spin 1s linear infinite;" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" opacity="0.25"/>
            <path fill="currentColor" d="M4 12a8 8 0 018-8v8z"/>
          </svg>
          Ajout en cours...
        </span>
      `;
      
      // Style pour l'animation de rotation
      const style = document.createElement('style');
      style.textContent = `
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `;
      document.head.appendChild(style);
      
      // Ajouter au panier via AJAX
      fetch('/cart/add.js', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          id: variantSelector.value,
          quantity: 1
        })
      })
      .then(response => response.json())
      .then(data => {
        console.log('✅ Success:', data);
        
        // Animation de succès
        this.style.background = 'linear-gradient(135deg, #10B981, #059669)';
        this.innerHTML = `
          <span style="display: inline-flex; align-items: center; gap: 8px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
              <path stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
            </svg>
            Ajouté avec succès !
          </span>
        `;
        
        // Effet de confetti
        createSuccessConfetti();
        
        setTimeout(() => {
          window.location.href = '/cart';
        }, 1500);
      })
      .catch((error) => {
        console.error('❌ Error:', error);
        
        // Animation d'erreur
        this.disabled = false;
        this.style.background = 'linear-gradient(135deg, #EF4444, #DC2626)';
        this.innerHTML = `
          <span style="display: inline-flex; align-items: center; gap: 8px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
              <path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
            </svg>
            Erreur - Réessayer
          </span>
        `;
        
        setTimeout(() => {
          this.style.background = '';
          this.textContent = 'AJOUTER AU PANIER';
        }, 3000);
      });
    });
  }
  
  // Initialiser avec la première variante disponible
  const selectedOption = document.querySelector('#shopify-section-' + sectionId + ' .offer-option.selected');
  if (selectedOption) {
    const variantId = selectedOption.dataset.variantId;
    selectVariant(variantId, sectionId);
  }
});

// Fonction pour créer un effet de confetti de succès
function createSuccessConfetti() {
  const colors = ['#10B981', '#0EA5E9', '#F59E0B', '#EF4444', '#8B5CF6'];
  const confettiCount = 50;
  
  for (let i = 0; i < confettiCount; i++) {
    const confetti = document.createElement('div');
    const color = colors[Math.floor(Math.random() * colors.length)];
    
    confetti.style.cssText = `
      position: fixed;
      width: ${Math.random() * 10 + 5}px;
      height: ${Math.random() * 10 + 5}px;
      background: ${color};
      left: ${Math.random() * 100}vw;
      top: -10px;
      z-index: 1000;
      border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
      animation: confettiFall ${Math.random() * 3 + 2}s linear forwards;
    `;
    
    document.body.appendChild(confetti);
    
    setTimeout(() => {
      if (document.body.contains(confetti)) {
        document.body.removeChild(confetti);
      }
    }, 5000);
  }
  
  // Style pour l'animation de confetti
  if (!document.getElementById('confetti-style')) {
    const style = document.createElement('style');
    style.id = 'confetti-style';
    style.textContent = `
      @keyframes confettiFall {
        to {
          transform: translateY(100vh) rotate(720deg);
          opacity: 0;
        }
      }
    `;
    document.head.appendChild(style);
  }
}
</script>

{% schema %}
{
  "name": "Page Produit Premium",
  "class": "shopify-section--product-premium",
  "tag": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Pleine largeur",
      "default": true
    },
    {
      "type": "header",
      "content": "🎨 Couleurs Modern Cart"
    },
    {
      "type": "paragraph",
      "content": "Ce design utilise automatiquement vos couleurs Modern Cart : Noir (#000000), Gris (#4A5568), Blanc (#FFFFFF), et Vert succès (#10B981)"
    },
    {
      "type": "header",
      "content": "📱 Galerie de médias"
    },
    {
      "type": "range",
      "id": "desktop_media_width",
      "label": "Largeur média desktop",
      "min": 35,
      "max": 65,
      "step": 5,
      "unit": "%",
      "default": 55
    },
    {
      "type": "select",
      "id": "desktop_media_layout",
      "label": "Disposition desktop",
      "options": [
        {"value": "grid_one", "label": "Grille (1x1)"},
        {"value": "grid", "label": "Grille (2x2)"},
        {"value": "grid_highlight", "label": "Grille highlight"},
        {"value": "carousel_thumbnails_left", "label": "Miniatures gauche"},
        {"value": "carousel_thumbnails_bottom", "label": "Miniatures bas"}
      ],
      "default": "carousel_thumbnails_left"
    },
    {
      "type": "select",
      "id": "mobile_media_size",
      "label": "Taille mobile",
      "options": [
        {"value": "expanded", "label": "Étendu"},
        {"value": "contained", "label": "Contenu"}
      ],
      "default": "expanded"
    },
    {
      "type": "select",
      "id": "mobile_carousel_control",
      "label": "Contrôle mobile",
      "options": [
        {"value": "dots", "label": "Points"},
        {"value": "floating_dots", "label": "Points flottants"},
        {"value": "thumbnails", "label": "Miniatures"},
        {"value": "free_scroll", "label": "Défilement libre"}
      ],
      "default": "floating_dots"
    }
  ],
  "presets": [
    {
      "name": "Page Produit Premium"
    }
  ]
}
{% endschema %}